{% extends "base.html" %}
{% block content %}
  <h1 class="text-3xl font-semibold mb-2">Dashboard</h1>
  <p class="text-sm text-gray-600 dark:text-gray-400 mb-6">Profile: <span id="who">Loadingâ€¦</span></p>

  <!-- clock widget -->
  <div class="bg-white dark:bg-gray-800 rounded-2xl shadow p-4 mb-6">
    <div class="flex flex-col items-center">
      <div id="clock" class="text-5xl font-bold">00:00:00 AM</div>
      <div id="date" class="text-xl text-gray-600 dark:text-gray-400">Loading date...</div>
    </div>
  </div>

  <!-- Grid layout for widgets -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <!-- Weather widget -->
    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow p-4">
      <h2 class="text-xl font-medium mb-3">Weather</h2>
      <div id="weather-container" hx-get="/weather/partial" hx-trigger="load, refreshWeather from:body" hx-swap="innerHTML"></div>
    </div>

    <!-- Quote widget -->
    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow p-4">
      <h2 class="text-xl font-medium mb-3">Daily Inspiration</h2>
      <div id="quote-container" hx-get="/quotes/partial" hx-trigger="load, refreshQuote from:body" hx-swap="innerHTML"></div>
    </div>
  </div>

  <!-- Full-width widgets -->
  <div class="mt-6 bg-white dark:bg-gray-800 rounded-2xl shadow p-4">
    <h2 class="text-xl font-medium mb-3">ToDo</h2>

    <form class="flex gap-2 mb-4"
          hx-post="/todo"
          hx-target="#todo-list"
          hx-swap="outerHTML">
      <input type="text" name="title" placeholder="New task..." required
       class="flex-1 border rounded-lg px-3 py-2 
              bg-white dark:bg-gray-800 
              border-gray-300 dark:border-gray-500 
              text-gray-900 dark:text-gray-100
              placeholder-gray-500 dark:placeholder-gray-400
              focus:ring-2 focus:ring-blue-500 focus:border-blue-500"/>
      <button type="submit" class="px-3 py-2 rounded-lg bg-black dark:bg-gray-600 text-white">Add</button>
    </form>

    <div id="todo-list"
         hx-get="/todo/partial"
         hx-trigger="load"></div>
  </div>

  <div class="mt-6 bg-white dark:bg-gray-800 rounded-2xl shadow p-4">
    <h2 class="text-xl font-medium mb-3">News Headlines</h2>
    <div id="news-container" hx-get="/news/partial" hx-trigger="load, refreshNews from:body" hx-swap="innerHTML"></div>
  </div>

  <script>
    fetch('/profiles/current').then(r=>r.json()).then(j=>{
      document.getElementById('who').textContent = j.name;
    });
  </script>

  <!-- clock script -->
  <script>
    function updateClock() {
      const now = new Date();
      
      // Update time - using 12-hour format with AM/PM
      const hours12 = now.getHours() % 12 || 12; // Convert 0 to 12
      const minutes = String(now.getMinutes()).padStart(2, '0');
      // const seconds = String(now.getSeconds()).padStart(2, '0');
      const ampm = now.getHours() >= 12 ? 'PM' : 'AM';
      document.getElementById('clock').textContent = `${hours12}:${minutes} ${ampm}`;
      
      // Update date
      const options = { 
        weekday: 'long', 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric' 
      };
      document.getElementById('date').textContent = now.toLocaleDateString(undefined, options);
    }
    
    // Update immediately
    updateClock();
    
    // Then update every second
    setInterval(updateClock, 1000);
  </script>
  
  <!-- Add this refresh script to control periodic updates manually -->
  <script>
    // Manual refresh of widgets at appropriate intervals
    setInterval(() => {
      htmx.trigger("#weather-container", "refreshWeather");
    }, 30 * 60 * 1000); // 30 minutes
    
    setInterval(() => {
      htmx.trigger("#quote-container", "refreshQuote");
    }, 24 * 60 * 60 * 1000); // 24 hours
    
    setInterval(() => {
      htmx.trigger("#news-container", "refreshNews");
    }, 2 * 60 * 60 * 1000); // 2 hours
  </script>
{% endblock %}